<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My EcoProfile</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .header h1 {
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 1;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      color: white;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s ease;
      z-index: 2;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .profile-content {
      padding: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #4CAF50, #2E7D32);
    }

    .stat-icon {
      font-size: 2.5em;
      margin-bottom: 15px;
      display: block;
    }

    .stat-value {
      font-size: 2.2em;
      font-weight: 700;
      color: #2E7D32;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 1.1em;
      color: #666;
      margin-bottom: 10px;
    }

    .stat-trend {
      font-size: 0.9em;
      color: #4CAF50;
      font-weight: 600;
    }

    .progress-section {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    .progress-section h3 {
      color: #2E7D32;
      font-size: 1.5em;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .level-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .level-badge {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1.1em;
    }

    .xp-info {
      color: #666;
      font-size: 0.95em;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #2E7D32);
      border-radius: 6px;
      transition: width 1s ease-out;
      animation: fillProgress 2s ease-out;
    }

    @keyframes fillProgress {
      from { width: 0%; }
    }

    .achievements {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .achievement {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .achievement.unlocked {
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      border-color: #f39c12;
      transform: scale(1.02);
    }

    .achievement.locked {
      opacity: 0.5;
      filter: grayscale(100%);
    }

    .achievement-icon {
      font-size: 2em;
      margin-bottom: 10px;
      display: block;
    }

    .achievement-name {
      font-size: 0.9em;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .achievement-desc {
      font-size: 0.8em;
      color: #666;
      line-height: 1.3;
    }

    .carbon-footprint {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    .carbon-savings {
      display: flex;
      justify-content: space-around;
      text-align: center;
      margin: 20px 0;
    }

    .carbon-metric {
      flex: 1;
    }

    .carbon-value {
      font-size: 2em;
      font-weight: 700;
      color: #27ae60;
      margin-bottom: 5px;
    }

    .carbon-unit {
      font-size: 0.9em;
      color: #666;
    }

    .impact-visualization {
      background: linear-gradient(135deg, #e8f5e8, #d4edda);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      text-align: center;
    }

    .tree-equivalent {
      font-size: 1.2em;
      color: #2E7D32;
      font-weight: 600;
    }

    .logout-section {
      text-align: center;
      margin-top: 30px;
    }

    .logout-btn {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(231, 76, 60, 0.3);
    }

    .daily-streak {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .streak-day {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .streak-day.active {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      transform: scale(1.1);
    }

    .streak-day.today {
      border: 3px solid #f39c12;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2em;
      }

      .achievements {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="back-btn" onclick="goBack()">‚Üê Back</button>
      <h1>üå± My EcoProfile</h1>
      <p>Track your environmental impact and achievements</p>
    </div>

    <div class="profile-content">
      <!-- User Info & Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">üë§</span>
          <div class="stat-value" id="userName">Loading...</div>
          <div class="stat-label">Eco Warrior</div>
          <div class="stat-trend">Member since today</div>
        </div>

        <div class="stat-card">
          <span class="stat-icon">üî•</span>
          <div class="stat-value" id="currentStreak">0</div>
          <div class="stat-label">Day Streak</div>
          <div class="stat-trend" id="streakTrend">Keep it up!</div>
        </div>

        <div class="stat-card">
          <span class="stat-icon">üìä</span>
          <div class="stat-value" id="totalClassifications">0</div>
          <div class="stat-label">Items Classified</div>
          <div class="stat-trend" id="classificationTrend">+0 this week</div>
        </div>

        <div class="stat-card">
          <span class="stat-icon">‚≠ê</span>
          <div class="stat-value" id="ecoScore">0</div>
          <div class="stat-label">Eco Score</div>
          <div class="stat-trend" id="scoreTrend">Beginner Level</div>
        </div>
      </div>

      <!-- Progress & Level -->
      <div class="progress-section">
        <h3>üèÜ Progress & Level</h3>
        <div class="level-info">
          <div class="level-badge" id="currentLevel">Eco Rookie</div>
          <div class="xp-info"><span id="currentXP">0</span> / <span id="nextLevelXP">100</span> XP</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="xpProgress" style="width: 0%"></div>
        </div>
        <div class="daily-streak">
          <div class="streak-day">M</div>
          <div class="streak-day">T</div>
          <div class="streak-day">W</div>
          <div class="streak-day">T</div>
          <div class="streak-day">F</div>
          <div class="streak-day">S</div>
          <div class="streak-day today">S</div>
        </div>
      </div>

      <!-- Achievements -->
      <div class="progress-section">
        <h3>üéØ Achievements</h3>
        <div class="achievements">
          <div class="achievement locked" id="firstClassification">
            <span class="achievement-icon">üéØ</span>
            <div class="achievement-name">First Step</div>
            <div class="achievement-desc">Classify your first item</div>
          </div>
          <div class="achievement locked" id="weekStreak">
            <span class="achievement-icon">üî•</span>
            <div class="achievement-name">Week Warrior</div>
            <div class="achievement-desc">7 days streak</div>
          </div>
          <div class="achievement locked" id="hundredItems">
            <span class="achievement-icon">üíØ</span>
            <div class="achievement-name">Century</div>
            <div class="achievement-desc">100 items classified</div>
          </div>
          <div class="achievement locked" id="carbonSaver">
            <span class="achievement-icon">üåç</span>
            <div class="achievement-name">Carbon Saver</div>
            <div class="achievement-desc">Save 10kg CO‚ÇÇ</div>
          </div>
          <div class="achievement locked" id="ecoMaster">
            <span class="achievement-icon">üëë</span>
            <div class="achievement-name">Eco Master</div>
            <div class="achievement-desc">Reach 1000 XP</div>
          </div>
          <div class="achievement locked" id="plasticHero">
            <span class="achievement-icon">‚ôªÔ∏è</span>
            <div class="achievement-name">Plastic Hero</div>
            <div class="achievement-desc">Classify 50 plastic items</div>
          </div>
        </div>
      </div>

      <!-- Carbon Footprint -->
      <div class="carbon-footprint">
        <h3 style="color: #2E7D32; font-size: 1.5em; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
          üåç Carbon Impact
        </h3>
        <div class="carbon-savings">
          <div class="carbon-metric">
            <div class="carbon-value" id="carbonSaved">0.0</div>
            <div class="carbon-unit">kg CO‚ÇÇ Saved</div>
          </div>
          <div class="carbon-metric">
            <div class="carbon-value" id="wasteRedirected">0</div>
            <div class="carbon-unit">Items Recycled</div>
          </div>
          <div class="carbon-metric">
            <div class="carbon-value" id="energySaved">0</div>
            <div class="carbon-unit">kWh Saved</div>
          </div>
        </div>
        <div class="impact-visualization">
          <div class="tree-equivalent" id="treeEquivalent">
            üå≥ Equivalent to planting 0 trees this month
          </div>
        </div>
      </div>

      <div class="logout-section">
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

  <script>
    // User data structure
    let userData = {
      name: '',
      email: '',
      totalClassifications: 0,
      currentStreak: 0,
      maxStreak: 0,
      ecoScore: 0,
      xp: 0,
      level: 1,
      carbonSaved: 0,
      wasteRedirected: 0,
      energySaved: 0,
      lastActiveDate: null,
      achievements: {
        firstClassification: false,
        weekStreak: false,
        hundredItems: false,
        carbonSaver: false,
        ecoMaster: false,
        plasticHero: false
      },
      dailyActivity: []
    };

    const levels = [
      { name: "Eco Rookie", minXP: 0, maxXP: 100 },
      { name: "Green Learner", minXP: 100, maxXP: 250 },
      { name: "Waste Warrior", minXP: 250, maxXP: 500 },
      { name: "Eco Champion", minXP: 500, maxXP: 1000 },
      { name: "Sustainability Master", minXP: 1000, maxXP: 2000 },
      { name: "Planet Guardian", minXP: 2000, maxXP: Infinity }
    ];

    // Carbon footprint calculations (estimated values)
    const carbonImpactValues = {
      'plastic bottle': { co2Saved: 0.5, energySaved: 2.5 },
      'plastic bag': { co2Saved: 0.2, energySaved: 1.0 },
      'plastic cover': { co2Saved: 0.15, energySaved: 0.8 },
      'plastic': { co2Saved: 0.3, energySaved: 1.5 },
      'other': { co2Saved: 0.1, energySaved: 0.5 }
    };

    async function loadProfile() {
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "index.html";
        return;
      }

      try {
        const res = await fetch("http://localhost:5000/profile", {
          method: "GET",
          headers: { "Authorization": `Bearer ${token}` }
        });
        const data = await res.json();

        if (res.ok) {
          userData.name = data.name;
          userData.email = data.email;
          
          // Load user stats from localStorage (in production, this would be from database)
          loadUserStats();
          updateDisplay();
        } else {
          alert("Session expired. Please log in again.");
          localStorage.removeItem("token");
          window.location.href = "index.html";
        }
      } catch (err) {
        alert("Cannot load profile, server not reachable.");
      }
    }

    function loadUserStats() {
      const saved = localStorage.getItem('userStats');
      if (saved) {
        const stats = JSON.parse(saved);
        userData = { ...userData, ...stats };
      }
      
      // Simulate some activity for demo
      if (userData.totalClassifications === 0) {
        userData.totalClassifications = Math.floor(Math.random() * 25) + 5;
        userData.currentStreak = Math.floor(Math.random() * 7) + 1;
        userData.ecoScore = userData.totalClassifications * 10 + userData.currentStreak * 5;
        userData.xp = userData.ecoScore;
        userData.carbonSaved = userData.totalClassifications * 0.3;
        userData.wasteRedirected = userData.totalClassifications;
        userData.energySaved = userData.totalClassifications * 1.2;
        
        // Unlock some achievements
        if (userData.totalClassifications > 0) {
          userData.achievements.firstClassification = true;
        }
        if (userData.currentStreak >= 7) {
          userData.achievements.weekStreak = true;
        }
        if (userData.carbonSaved >= 10) {
          userData.achievements.carbonSaver = true;
        }
        
        saveUserStats();
      }
    }

    function saveUserStats() {
      localStorage.setItem('userStats', JSON.stringify(userData));
    }

    function updateDisplay() {
      // Basic info
      document.getElementById('userName').textContent = userData.name;
      document.getElementById('currentStreak').textContent = userData.currentStreak;
      document.getElementById('totalClassifications').textContent = userData.totalClassifications;
      document.getElementById('ecoScore').textContent = userData.ecoScore;

      // Level and XP
      const currentLevel = getCurrentLevel();
      document.getElementById('currentLevel').textContent = currentLevel.name;
      document.getElementById('currentXP').textContent = userData.xp;
      document.getElementById('nextLevelXP').textContent = currentLevel.maxXP === Infinity ? '‚àû' : currentLevel.maxXP;
      
      const xpProgress = currentLevel.maxXP === Infinity ? 100 : 
        ((userData.xp - currentLevel.minXP) / (currentLevel.maxXP - currentLevel.minXP)) * 100;
      document.getElementById('xpProgress').style.width = `${Math.min(xpProgress, 100)}%`;

      // Trends
      document.getElementById('streakTrend').textContent = userData.currentStreak > 3 ? "üî• On fire!" : "Keep it up!";
      document.getElementById('classificationTrend').textContent = `+${Math.floor(userData.totalClassifications / 7)} this week`;
      document.getElementById('scoreTrend').textContent = currentLevel.name;

      // Carbon impact
      document.getElementById('carbonSaved').textContent = userData.carbonSaved.toFixed(1);
      document.getElementById('wasteRedirected').textContent = userData.wasteRedirected;
      document.getElementById('energySaved').textContent = userData.energySaved.toFixed(0);
      
      const treesEquivalent = Math.floor(userData.carbonSaved / 22); // ~22kg CO2 per tree per year
      document.getElementById('treeEquivalent').textContent = 
        `üå≥ Equivalent to planting ${treesEquivalent} tree${treesEquivalent !== 1 ? 's' : ''} this month`;

      // Achievements
      updateAchievements();
      
      // Daily streak visualization
      updateStreakDisplay();
    }

    function getCurrentLevel() {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (userData.xp >= levels[i].minXP) {
          return levels[i];
        }
      }
      return levels[0];
    }

    function updateAchievements() {
      Object.keys(userData.achievements).forEach(achievementKey => {
        const element = document.getElementById(achievementKey);
        if (element) {
          if (userData.achievements[achievementKey]) {
            element.classList.remove('locked');
            element.classList.add('unlocked');
          }
        }
      });
    }

    function updateStreakDisplay() {
      const streakDays = document.querySelectorAll('.streak-day');
      const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
      
      streakDays.forEach((day, index) => {
        if (index < userData.currentStreak && index <= today) {
          day.classList.add('active');
        }
        if (index === today) {
          day.classList.add('today');
        }
      });
    }

    function addClassificationActivity(wasteType) {
      userData.totalClassifications++;
      userData.ecoScore += 10;
      userData.xp += 10;
      
      if (carbonImpactValues[wasteType]) {
        userData.carbonSaved += carbonImpactValues[wasteType].co2Saved;
        userData.energySaved += carbonImpactValues[wasteType].energySaved;
      }
      userData.wasteRedirected++;
      
      // Check for streak
      const today = new Date().toDateString();
      if (userData.lastActiveDate !== today) {
        const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();
        if (userData.lastActiveDate === yesterday) {
          userData.currentStreak++;
        } else {
          userData.currentStreak = 1;
        }
        userData.lastActiveDate = today;
      }
      
      // Check achievements
      checkAchievements();
      saveUserStats();
      updateDisplay();
    }

    function checkAchievements() {
      if (userData.totalClassifications >= 1 && !userData.achievements.firstClassification) {
        userData.achievements.firstClassification = true;
        showAchievementUnlocked("First Step", "üéØ");
      }
      
      if (userData.currentStreak >= 7 && !userData.achievements.weekStreak) {
        userData.achievements.weekStreak = true;
        showAchievementUnlocked("Week Warrior", "üî•");
      }
      
      if (userData.totalClassifications >= 100 && !userData.achievements.hundredItems) {
        userData.achievements.hundredItems = true;
        showAchievementUnlocked("Century", "üíØ");
      }
      
      if (userData.carbonSaved >= 10 && !userData.achievements.carbonSaver) {
        userData.achievements.carbonSaver = true;
        showAchievementUnlocked("Carbon Saver", "üåç");
      }
      
      if (userData.xp >= 1000 && !userData.achievements.ecoMaster) {
        userData.achievements.ecoMaster = true;
        showAchievementUnlocked("Eco Master", "üëë");
      }
    }

    function showAchievementUnlocked(name, icon) {
      // Simple achievement notification (could be enhanced with a modal)
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #4CAF50, #2E7D32);
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        z-index: 1000;
        animation: slideInRight 0.5s ease-out;
      `;
      notification.innerHTML = `<strong>${icon} Achievement Unlocked!</strong><br>${name}`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    function goBack() {
      window.location.href = "dashboard.html";
    }

    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("userStats");
      window.location.href = "index.html";
    }

    // Initialize on page load
   if (res.ok) {
  userData.name = data.name;
  userData.email = data.email;
  if (data.stats) {
    userData = { ...userData, ...data.stats };
    userData.xp = userData.ecoScore; // XP tied to ecoScore
  }
  updateDisplay();
}



    // Listen for classification events from other pages
    window.addEventListener('storage', function(e) {
      if (e.key === 'newClassification') {
        const data = JSON.parse(e.newValue);
        addClassificationActivity(data.wasteType);
        localStorage.removeItem('newClassification'); // Clean up
      }
    });
  </script>
</body>
</html>